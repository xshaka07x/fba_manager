{% extends "base.html" %}

{% block title %}Analyse Excel - FBA Manager{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h1 class="h3 mb-0 text-gray-800">Analyse de fichier Excel</h1>
        </div>
    </div>

    <div class="row">
        <div class="col-xl-6 mx-auto">
            <div class="card bg-dark text-white shadow">
                <div class="card-header">
                    <h5 class="card-title mb-0">Importer un fichier Excel</h5>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('main.analyze_excel_route') }}" method="post" enctype="multipart/form-data" class="text-center">
                        <div class="mb-4">
                            <div class="upload-zone p-4 border border-dashed rounded">
                                <i class="fas fa-file-excel fa-3x mb-3 text-primary"></i>
                                <p class="mb-2">Glissez votre fichier Excel ici</p>
                                <p class="text-muted small">ou</p>
                                <input type="file" name="file" id="file" class="d-none" accept=".xlsx">
                                <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('file').click()">
                                    SÃ©lectionner un fichier
                                </button>
                                <p class="selected-file mt-2 text-muted"></p>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" disabled>
                            <i class="fas fa-search me-2"></i>Analyser
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('file').addEventListener('change', function(e) {
    const fileName = e.target.files[0]?.name;
    if (fileName) {
        document.querySelector('.selected-file').textContent = fileName;
        document.querySelector('button[type="submit"]').disabled = false;
    }
});

// Gestion du drag & drop
const dropZone = document.querySelector('.upload-zone');

['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    dropZone.addEventListener(eventName, preventDefaults, false);
});

function preventDefaults (e) {
    e.preventDefault();
    e.stopPropagation();
}

['dragenter', 'dragover'].forEach(eventName => {
    dropZone.addEventListener(eventName, highlight, false);
});

['dragleave', 'drop'].forEach(eventName => {
    dropZone.addEventListener(eventName, unhighlight, false);
});

function highlight(e) {
    dropZone.classList.add('border-primary');
}

function unhighlight(e) {
    dropZone.classList.remove('border-primary');
}

dropZone.addEventListener('drop', handleDrop, false);

function handleDrop(e) {
    const dt = e.dataTransfer;
    const files = dt.files;
    
    if (files.length > 0 && files[0].name.endsWith('.xlsx')) {
        document.getElementById('file').files = files;
        document.querySelector('.selected-file').textContent = files[0].name;
        document.querySelector('button[type="submit"]').disabled = false;
    }
}
</script>

<style>
.upload-zone {
    border: 2px dashed rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
    cursor: pointer;
}

.upload-zone:hover {
    border-color: var(--bs-primary);
}

.border-dashed {
    border-style: dashed !important;
}

.selected-file {
    font-size: 0.9rem;
    word-break: break-all;
}
</style>
{% endblock %} 